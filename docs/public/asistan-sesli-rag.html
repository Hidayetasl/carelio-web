<!doctype html>
<html lang="tr">
<head>
  <meta name="description" content="Carelio – sağlık hizmetleri platformu. Bu sayfaya ait kısa açıklama sonradan özelleştirilecektir.">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Carelio – Ziyaretçi Asistan</title>
<link rel="stylesheet" href="./style.css"/>
<script src="./config.js" defer></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KPS9ZNVXCL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-KPS9ZNVXCL');
</script>

</head>
  <link rel="stylesheet" href="assets/layout.css">
  <script defer src="assets/_layout.js"></script>
<body>
  <div class="container">
    <div class="card">
      <h1>Carelio – Ziyaretçi Asistan</h1>
      <p class="small">Sorunuzu yazın ve <b>Yanıtla</b>’ya tıklayın. Örnekler: <i>“careli kime ait”</i>, <i>“paket fiyatları”</i>, <i>“acil durumlarda ne yapar?”</i></p>
      <div class="row">
        <div>
          <label for="q">Soru</label>
          <input id="q" placeholder="Sorunuzu yazın..."/>
        </div>
        <div style="align-self:end">
          <button id="askBtn">Yanıtla</button>
        </div>
      </div>
      <div class="hr"></div>
      <div id="out">
        <h3>Yanıt</h3>
        <div id="answer" class="src">—</div>
        <div class="flex">
          <span class="badge">kaynaklar</span>
          <div id="sources" class="small">—</div>
        </div>
        <div class="flex">
          <span class="badge">anahtar kelimeler</span>
          <div id="kw" class="small">—</div>
        </div>
      </div>
      <footer>v1.0 • Clean build • <a href="/anket-kisa.html">Anket</a></footer>
    </div>
  </div>

  <script type="module">
    import { ask } from "./client-rag.v2.js";
    const q = document.getElementById('q');
    const btn = document.getElementById('askBtn');
    const ans = document.getElementById('answer');
    const src = document.getElementById('sources');
    const kw  = document.getElementById('kw');

    async function run(){
      btn.disabled = true;
      ans.textContent = "Düşünüyorum...";
      try{
        const { text, sources, keywords } = await ask(q.value || "");
        ans.innerHTML = text.replaceAll("\n","<br>");
        src.innerHTML = (sources||[]).join("<br>") || "—";
        kw.textContent = (keywords||[]).join(", ") || "—";
      }catch(e){
        console.error(e);
        ans.textContent = "Bir sorun oldu: " + e.message;
      }finally{
        btn.disabled = false;
      }
    }
    btn.addEventListener('click', run);
    q.addEventListener('keydown', (e)=>{ if(e.key==='Enter') run(); });
  </script>
</body>
</html>
<script>
(function(){
  // Kartın sonuna "Sesle Oku" butonu ekle
  const card = document.querySelector('.card');
  if (!card) return;
  const btn = document.createElement('button');
  btn.id = 'speakBtn';
  btn.textContent = 'Sesle Oku';
  btn.style.marginTop = '12px';
  btn.onclick = function(){
    try{
      const el = document.getElementById('answer');
      const raw = (el?.innerText || el?.textContent || '').trim();
      // "Carelio"yu TTS için "Karelio" olarak değiştir
      const ttsText = raw.replace(/carelio/gi, 'Karelio');
      const u = new SpeechSynthesisUtterance(ttsText);
      u.lang = 'tr-TR'; u.rate = 1; u.pitch = 1;
      speechSynthesis.cancel(); speechSynthesis.speak(u);
    }catch(e){ console.warn('TTS hata:', e); }
  };
  card.appendChild(btn);
})();
</script>
<script>(function(){
  const card=document.querySelector('.card'); if(!card) return;
  const btn=document.createElement('button');
  btn.id='openSurvey'; btn.textContent='Anketi Aç';
  btn.style.margin='12px 0 0 8px'; btn.style.display='none';
  btn.onclick=()=>location.href='/anket-kisa.html';
  card.appendChild(btn);

  const answer=document.getElementById('answer');
  function scan(){
    const t=(answer?.innerText||answer?.value||'').toLowerCase();
    btn.style.display = /paket|fiyat/.test(t) ? 'inline-block' : 'none';
  }
  if(answer){
    new MutationObserver(scan).observe(answer,{subtree:true,childList:true,characterData:true});
    setInterval(scan,1000); scan();
  }
})();</script>
<script>(function(){
  const card=document.querySelector('.card'); if(!card) return;
  const btn=document.createElement('button');
  btn.id='openSurvey'; btn.textContent='Anketi Aç';
  btn.style.margin='12px 0 0 8px'; btn.style.display='none';
  btn.onclick=()=>location.href='/anket-kisa.html';
  card.appendChild(btn);

  const answer=document.getElementById('answer');
  function scan(){
    const t=(answer?.innerText||answer?.value||'').toLowerCase();
    btn.style.display = /paket|fiyat/.test(t) ? 'inline-block' : 'none';
  }
  if(answer){
    new MutationObserver(scan).observe(answer,{subtree:true,childList:true,characterData:true});
    setInterval(scan,1000); scan();
  }
})();</script>

